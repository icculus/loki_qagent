include ../host.def

.PHONY: all

.PRECIOUS: %.h %.moc.cpp %.moc.o %.cpp %impl.h %impl.cpp build/x11/%.moc.cpp build/embedded/%.moc.cpp

all: build build/x11/qagent_x11 build/embedded/qagent_embedded

CC=gcc
CPP=gcc

############## QT TRANSLATION SUPPORT ###############

# All translated files.

qmfiles = qagent_en.qm

# FIXME: qagent.pro should be automatically generated by the makefile.

%.qm : %.ts qagent.pro
	lrelease qagent.pro

############## BUILDS OF DOOM AND EVIL ###############

X11_CPPFLAGS=-I$(QTX11DIR)/include
X11_CFLAGS=-I$(QTX11DIR)/include

X11_MOC=$(QTX11DIR)/bin/moc

x11_objects = \
	build/x11/qagentimpl.moc.o \
	build/x11/qagentimpl.o \
	build/x11/qagent.moc.o \
	build/x11/qagent.o \
	build/x11/utils.o \
	build/x11/x_utils.o \
	build/x11/main.o \
	build/x11/qt_gui.o \
	build/x11/KDE/kprocctrl.moc.o \
	build/x11/KDE/kprocess.o \
	build/x11/KDE/kprocctrl.o \
	build/x11/KDE/kprocess.moc.o

build/x11/qagent_x11: $(x11_objects)
	export QTDIR=$(QTX11DIR)
	$(CPP) -pipe -g -o $@ $(x11_objects) -L$(QTX11DIR)/lib -lqt

build/x11/%.moc.o : build/x11/%.moc.cpp
	$(CPP) -c $< -o $@ $(X11_CPPFLAGS)

build/x11/%.moc.cpp: %.h
	$(X11_MOC) -o $@ $<

build/x11/%.o : %.cpp
	$(CPP) -c $< -o $@ $(X11_CPPFLAGS)

build/:
	mkdir build
	mkdir build/x11
	mkdir build/x11/KDE
	mkdir build/embedded
	mkdir build/embedded/KDE

############## EMBEDDED BUILD OF DOOM AND EVIL ###############

EMBEDDED_CPPFLAGS=-I$(QTEMBEDDEDDIR)/include
EMBEDDED_CFLAGS=-I$(QTEMBEDDEDDIR)/include

EMBEDDED_MOC=$(QTEMBEDDEDDIR)/bin/moc

embedded_objects = \
	build/embedded/qagentimpl.moc.o \
	build/embedded/qagentimpl.o \
	build/embedded/qagent.moc.o \
	build/embedded/qagent.o \
	build/embedded/utils.o \
	build/embedded/x_utils.o \
	build/embedded/main.o \
	build/embedded/qt_gui.o \
	build/embedded/KDE/kprocctrl.moc.o \
	build/embedded/KDE/kprocess.o \
	build/embedded/KDE/kprocctrl.o \
	build/embedded/KDE/kprocess.moc.o

build/embedded/qagent_embedded: $(embedded_objects)
	export QTDIR=$(QTEMBEDDEDDIR)
	$(CPP) -pipe -g -o $@ $(embedded_objects) -L$(QTEMBEDDEDDIR)/lib -lqte

build/embedded/%.moc.o : build/embedded/%.moc.cpp
	$(CPP) -c $< -o $@ $(X11_CPPFLAGS)

build/embedded/%.moc.cpp: %.h
	$(EMBEDDED_MOC) -o $@ $<

build/embedded/%.o : %.cpp
	$(CPP) -c $< -o $@ $(EMBEDDED_CPPFLAGS)
	
######### Put away your toys. ########

clean:
	rm -rf build
